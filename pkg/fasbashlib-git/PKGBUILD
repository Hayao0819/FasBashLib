# Maintainer : Yamada Hayao <development@fascode.net>

pkgname=fasbashlib-git
pkgver=v0.1.2.r4.g5862cfc
pkgrel=1
pkgdesc='A collection of small but awasome functions for Bash'
arch=('any')
url='https:/fascode.net'
license=('MIT SUSHI-WARE')
makedepends=("git")
source=("git+https://github.com/Hayao0819/FasBashLib.git")
sha256sums=('SKIP')

pkgver() {
    cd "FasBashLib"
    git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare(){
    cd "FasBashLib"
    git submodule update --init --recursive
}

package() {
    # Create dir
    mkdir -p "$pkgdir/usr/lib/fasbashlib/"
    mkdir -p "$pkgdir/usr/share/doc/fasbashlib/"
    mkdir -p "$pkgdir/usr/share/licenses/fasbashlib"

    # install multifile
    "${srcdir}/FasBashLib/bin/MuitlFile.sh" -out "$pkgdir/usr/lib/fasbashlib/"

    # install singlefile
    "${srcdir}/FasBashLib/bin/SingleFile.sh" -debug -out "$pkgdir/usr/lib/fasbashlib.sh" -ver "v${pkgver}"

    # install docs
    "$srcdir/FasBashLib/bin/GenDoc.sh" -out "${pkgdir}/usr/share/doc/fasbashlib/"

    # install license
    install -Dm 644 "$srcdir/FasBashLib/LICENSE.md" "$pkgdir/usr/share/licenses/fasbashlib/LICENSE.md"

    # install fasbashlib command
    install -Dm 755 "$srcdir/FasBashLib/misc/fasbashlib" "$pkgdir/usr/bin/fasbashlib"
}
